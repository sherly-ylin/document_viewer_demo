SELECT '<OR.ACCESSORIES>' + dbo.fn_FormatXMLChars(isnull((select stuff((select ', ' + Model from SNOrderLine with (nolock) where OrderID = OD.OrderID and SeqNbr >= case when OD.AccessoryOnlyInd = 0 then 2 else 1 end order by SeqNbr for xml path('')),1,2,'')),'')) + '</OR.ACCESSORIES>'
            + '<OR.ADJCOSTAMT>' + dbo.fn_FormatCurrency(((SELECT SUM(ISNULL(BuyPrice,0) * Quantity) FROM SNOrderLine with (nolock) WHERE ISNULL(ServiceInd,0) = 0 AND OrderID = OD.OrderID) - OD.SRCommCSMPCreditValue)) + '</OR.ADJCOSTAMT>'
            + '<OR.ADJGPAMT>' + dbo.fn_FormatCurrency(OD.AdjGPAmt) + '</OR.ADJGPAMT>'
            + '<OR.ADJGPPCT>' + dbo.fn_formatnumber(OD.AdjGPPCT * 100,2) + '%' + '</OR.ADJGPPCT>'
            + '<OR.AMTFINANCED>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(OD.AmtFinanced) end + '</OR.AMTFINANCED>'
            + '<OR.AMTFIN-LBO>' + case when isnull(OD.AmtFinanced,0) = 0 then '' else dbo.fn_FormatCurrency(OD.AmtFinanced - OD.BuyoutAmt) end + '</OR.AMTFIN-LBO>'
            + '<OR.BASEBILLFREQANX>' +  case when isnull(BT.PaymentsPerYear,0) = 1 then 'X' else '' end + '</OR.BASEBILLFREQANX>'
            + '<OR.BASEBILLFREQMOX>' +  case when isnull(BT.PaymentsPerYear,0) = 12 then 'X' else '' end + '</OR.BASEBILLFREQMOX>'
            + '<OR.BASEBILLFREQQTRX>' +  case when isnull(BT.PaymentsPerYear,0) = 4 then 'X' else '' end + '</OR.BASEBILLFREQQTRX>'
            + '<OR.BASEBILLFREQSAX>' +  case when isnull(BT.PaymentsPerYear,0) = 2 then 'X' else '' end + '</OR.BASEBILLFREQSAX>'
            + '<OR.BASEBILLINLSNOX>' +  case when isnull(BT.IncludeInLease,0) = 0 then 'X' else '' end + '</OR.BASEBILLINLSNOX>'
            + '<OR.BASEBILLINLSYESX>' +  case when isnull(BT.IncludeInLease,0) = -1 then 'X' else '' end + '</OR.BASEBILLINLSYESX>'
            + '<OR.BASEGPAMT>' + dbo.fn_FormatCurrency(OD.GPTotal) + '</OR.BASEGPAMT>'
            + '<OR.BASEGPPCT>' + dbo.fn_formatnumber(OD.TotalGPPCT * 100,2) + '%' + '</OR.BASEGPPCT>'
            + '<OR.BASELEASEPAYMENT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(OD.AmtFinanced ,0) * isnull(OD.LeaseFactor ,0))  end + '</OR.BASELEASEPAYMENT>'
            + '<OR.BASELEASEPAYMENTNOSIGN>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else replace(dbo.fn_FormatCurrency(isnull(OD.AmtFinanced ,0) * isnull(OD.LeaseFactor ,0)),'$','') end + '</OR.BASELEASEPAYMENTNOSIGN>'
            + '<OR.BIDDESKLABEL>' + case when isnull(OD.BidDeskDTReqSRepReview,'1/1/1900') <> '1/1/1900' then case when isnull(OD.BidDeskDTSRepReviewed,'1/1/1900') = '1/1/1900' then 'Requested Rep Review (' + convert(varchar,OD.BidDeskDTReqSRepReview,1) + ' ' + right(convert(varchar,OD.BidDeskDTReqSRepReview,100),7) + ')' else case upper(OD.BidDeskSRepStatus) when 'A' then 'Accepted By Rep (' + convert(varchar,OD.BidDeskDTSRepReviewed,1) + ' ' + right(convert(varchar,OD.BidDeskDTSRepReviewed,100),7) + ')' when 'R' then 'Rejected By Rep (' + convert(varchar,OD.BidDeskDTSRepReviewed,1) + ' ' + right(convert(varchar,OD.BidDeskDTSRepReviewed,100),7) + ')' else 'Unrecognized Status (' + OD.BidDeskSRepStatus + ')' end end else '' end + '</OR.BIDDESKLABEL>'
            + '<OR.BILLINGCUSTOMERNAME>' + dbo.fn_FormatXMLChars(isnull(OD.BillingCustomerName ,'')) + '</OR.BILLINGCUSTOMERNAME>'
            + '<OR.BILLINGOMDCUSTOMERNBR>' + dbo.fn_FormatXMLChars(isnull(BCU.OMDCustomerNbr ,'')) + '</OR.BILLINGOMDCUSTOMERNBR>'
            + '<OR.BILLINGCUSTOMERASSOCIATION>' + case when (select isnull(ct.TypeInd,'') from SNCompany co with (nolock) left join SNCompanyType ct with (nolock) on ct.CompanyTypeID = co.CompanyTypeID where co.CompanyID = BCU.CompanyID) = 'A' then 'X' else '' end + '</OR.BILLINGCUSTOMERASSOCIATION>'
            + '<OR.BILLINGCUSTOMERCORPORATION>' + case when (select isnull(ct.TypeInd,'') from SNCompany co with (nolock) left join SNCompanyType ct with (nolock) on ct.CompanyTypeID = co.CompanyTypeID where co.CompanyID = BCU.CompanyID) = 'C' then 'X' else '' end + '</OR.BILLINGCUSTOMERCORPORATION>'
            + '<OR.BILLINGCUSTOMERLLC>' + case when (select isnull(ct.TypeInd,'') from SNCompany co with (nolock) left join SNCompanyType ct with (nolock) on ct.CompanyTypeID = co.CompanyTypeID where co.CompanyID = BCU.CompanyID) = 'L' then 'X' else '' end + '</OR.BILLINGCUSTOMERLLC>'
            + '<OR.BILLINGCUSTOMERMUNICIPALITY>' + case when (select isnull(ct.TypeInd,'') from SNCompany co with (nolock) left join SNCompanyType ct with (nolock) on ct.CompanyTypeID = co.CompanyTypeID where co.CompanyID = BCU.CompanyID) = 'M' then 'X' else '' end + '</OR.BILLINGCUSTOMERMUNICIPALITY>'
            + '<OR.BILLINGCUSTOMERPARTNERSHIP>' + case when (select isnull(ct.TypeInd,'') from SNCompany co with (nolock) left join SNCompanyType ct with (nolock) on ct.CompanyTypeID = co.CompanyTypeID where co.CompanyID = BCU.CompanyID) = 'T' then 'X' else '' end + '</OR.BILLINGCUSTOMERPARTNERSHIP>'
            + '<OR.BILLINGCUSTOMERPROPRIETORSHIP>' + case when (select isnull(ct.TypeInd,'') from SNCompany co with (nolock) left join SNCompanyType ct with (nolock) on ct.CompanyTypeID = co.CompanyTypeID where co.CompanyID = BCU.CompanyID) = 'P' then 'X' else '' end + '</OR.BILLINGCUSTOMERPROPRIETORSHIP>'
            + '<OR.BILLINGCUSTOMERTYPE>' + dbo.fn_FormatXMLChars(isnull((select Name from SNCompanyType with (nolock) where CompanyTypeID = (select CompanyTypeID from SNCompany with (nolock) where CompanyID = BCU.CompanyID)),'')) + '</OR.BILLINGCUSTOMERTYPE>'
            + '<OR.BILLINGCUSTOMERFEDID>' + dbo.fn_FormatXMLChars(isnull((select FedIDNbr from SNCompany with (nolock) where CompanyID = BCU.CompanyID),'')) + '</OR.BILLINGCUSTOMERFEDID>'
            + '<OR.BILLINGADDRESS1>' + dbo.fn_FormatXMLChars(isnull(OD.BillingAddress1 ,'')) + '</OR.BILLINGADDRESS1>'
            + '<OR.BILLINGADDRESS2>' + dbo.fn_FormatXMLChars(isnull(OD.BillingAddress2 ,'')) + '</OR.BILLINGADDRESS2>'
            + '<OR.BILLINGCITY>' + dbo.fn_FormatXMLChars(isnull(OD.BillingCity ,'')) + '</OR.BILLINGCITY>'
            + '<OR.BILLINGSTATE>' + dbo.fn_FormatXMLChars(isnull(OD.BillingState ,'')) + '</OR.BILLINGSTATE>'
            + '<OR.BILLINGZIP>' + dbo.fn_FormatXMLChars(isnull(OD.BillingPostalCode ,'')) + '</OR.BILLINGZIP>'
            + '<OR.BILLINGADDRESSLABEL>' + dbo.fn_FormatXMLChars(case when len(OD.BillingCity) > 0 then OD.BillingAddress1 + case when LEN(OD.BillingAddress2) > 0 then CHAR(13) + CHAR(10) + OD.BillingAddress2 else '' end  + CHAR(13) + CHAR(10) + OD.BillingCity + ', ' + OD.BillingState + ' ' + OD.BillingPostalCode else '' end) + '</OR.BILLINGADDRESSLABEL>'
            + '<OR.BILLINGADDRESSONELINE>' + dbo.fn_FormatXMLChars(case when len(OD.BillingCity) > 0 then OD.BillingAddress1 + case when LEN(OD.BillingAddress2) > 0 then OD.BillingAddress2 else '' end  + ', ' + OD.BillingCity + ', ' + OD.BillingState + ' ' + OD.BillingPostalCode else '' end) + '</OR.BILLINGADDRESSONELINE>'
            + '<OR.BILLINGCONTACTFIRSTNAME>' + case when isnull(OD.BillToContactSelect,-1) > 0 then dbo.fn_FormatXMLChars(isnull((select p.FirstName from SNContact c with (nolock) join SNPerson p with (nolock) on p.PersonID = c.PersonID where c.ContactID = OD.BillToContactSelect),'')) else dbo.fn_FormatXMLChars(isnull(OD.BillingContactName ,'')) end + '</OR.BILLINGCONTACTFIRSTNAME>'
            + '<OR.BILLINGCONTACTLASTNAME>' + case when isnull(OD.BillToContactSelect,-1) > 0 then dbo.fn_FormatXMLChars(isnull((select p.LastName from SNContact c with (nolock) join SNPerson p with (nolock) on p.PersonID = c.PersonID where c.ContactID = OD.BillToContactSelect),'')) else '' end + '</OR.BILLINGCONTACTLASTNAME>'
            + '<OR.BILLINGCONTACTNAME>' + dbo.fn_FormatXMLChars(isnull(OD.BillingContactName ,'')) + '</OR.BILLINGCONTACTNAME>'
            + '<OR.BILLINGCONTACTTITLE>' + dbo.fn_FormatXMLChars(isnull(case when OD.BillToContactSelect > 0 then (SELECT Title FROM SNContact with (nolock) WHERE ContactID = OD.BillToContactSelect) else '' end,'')) + '</OR.BILLINGCONTACTTITLE>'
            + '<OR.BILLINGCONTACTEMAILADDR>' + dbo.fn_FormatXMLChars(isnull(OD.BillingContactEmailAddr ,'')) + '</OR.BILLINGCONTACTEMAILADDR>'
            + '<OR.BILLINGCONTACTPHONENBR>' + dbo.fn_FormatPhoneNumber(OD.BillingContactPhoneNbr) + case when isnull(OD.BillingContactPhoneExt,'') <> '' then 'x' + isnull(OD.BillingContactPhoneExt,'') else '' end + '</OR.BILLINGCONTACTPHONENBR>'
            + '<OR.BILLINGCONTACTFAXNBR>' + dbo.fn_FormatPhoneNumber(OD.BillingContactFaxNbr) + '</OR.BILLINGCONTACTFAXNBR>'
            + '<OR.BILLINGCONTACTCELLNBR>' + dbo.fn_FormatPhoneNumber(OD.BillingContactCellNbr) + '</OR.BILLINGCONTACTCELLNBR>'
            + '<OR.BLENDESCTEXT>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then 'Service rates are fixed for the term of the contract' else '' end + '</OR.BLENDESCTEXT>'
            + '<OR.BOTDESCRIPTION>' + dbo.fn_FormatXMLChars(isnull(OD.ITP_BOT_Description,'')) + '</OR.BOTDESCRIPTION>'
            + '<OR.BOTDOWNPAYMENT>' + dbo.fn_FormatCurrency(isnull(OD.ITPBOTDownPayment,0)) + '</OR.BOTDOWNPAYMENT>'
            + '<OR.BOTHOURLYRATE>' + dbo.fn_FormatCurrency(isnull(OD.ITP_BOT_HourlyRate,0)) + '</OR.BOTHOURLYRATE>'
            + '<OR.BOTHOURS>' + case when isnull(OD.ITP_BOTHrs,-1) = -1 then '' else dbo.fn_FormatNumber(OD.ITP_BOTHrs,0) end + '</OR.BOTHOURS>'
            + '<OR.BOTORIGINALRATE>' + dbo.fn_FormatCurrency(isnull((select MoRepCost from SNServicesItem with (nolock) where ServicesItemID = (select top 1 ITP_BlockOfTimeServicesItemID from SNSystemParm with (nolock))),0)) + '</OR.BOTORIGINALRATE>'
            + '<OR.BOTPPAYMENT>' + dbo.fn_FormatCurrency(case when isnull(BTB.IsInLeaseInd,0) = -1 then isnull(OD.LeaseFactor ,0) * isnull(OD.ITP_BOT_TotalCharge,0) else isnull(OD.ITP_BOT_TotalCharge,0) end) + '</OR.BOTPPAYMENT>'
            + '<OR.BOTPAYMENTTERM>' + dbo.fn_FormatXMLChars(isnull(BTB.Name,'')) + '</OR.BOTPAYMENTTERM>'
            + '<OR.BOTTOTALCHARGE>' + dbo.fn_FormatCurrency(isnull(OD.ITP_BOT_TotalCharge,0)) + '</OR.BOTTOTALCHARGE>'
            + '<OR.BRANCH>' + dbo.fn_FormatXMLChars(isnull(BR.BranchName ,'')) + '</OR.BRANCH>'
            + '<OR.BRANCHABBREV>' + dbo.fn_FormatXMLChars(isnull(BR.Abbreviation ,'')) + '</OR.BRANCHABBREV>'
            + '<OR.BRANCHLEGALNAME>' + dbo.fn_FormatXMLChars(isnull(BR.LegalName ,'')) + '</OR.BRANCHLEGALNAME>'
            + '<OR.BRANCHADDRESS>' + dbo.fn_FormatXMLChars(case when len(BR.City) > 0 then BR.Addr1 + case when LEN(BR.Addr2) > 0 then CHAR(10) + CHAR(13) + BR.Addr2 else '' end  + CHAR(10) + CHAR(13) + BR.City + ', ' + BR.State + ' ' + BR.PostalCode else '' end) + '</OR.BRANCHADDRESS>'
            + '<OR.BRANCHADDR1>' + dbo.fn_FormatXMLChars(isnull(BR.Addr1 ,'')) + '</OR.BRANCHADDR1>'
            + '<OR.BRANCHADDR2>' + dbo.fn_FormatXMLChars(isnull(BR.Addr2 ,'')) + '</OR.BRANCHADDR2>'
            + '<OR.BRANCHCITY>' + dbo.fn_FormatXMLChars(isnull(BR.City ,'')) + '</OR.BRANCHCITY>'
            + '<OR.BRANCHSTATE>' + dbo.fn_FormatXMLChars(isnull(BR.State ,'')) + '</OR.BRANCHSTATE>'
            + '<OR.BRANCHPOSTALCODE>' + dbo.fn_FormatXMLChars(isnull(BR.PostalCode ,'')) + '</OR.BRANCHPOSTALCODE>'
            + '<OR.BRANCHPHONE>' + dbo.fn_FormatPhoneNumber(BR.Phone) + '</OR.BRANCHPHONE>'
            + '<OR.BRANCHFAX>' + dbo.fn_FormatPhoneNumber(BR.Fax) + '</OR.BRANCHFAX>'
            + '<OR.BRANCHIMAGELARGE>' + dbo.fn_FormatXMLChars(isnull(BR.ImageLarge,'')) + '</OR.BRANCHIMAGELARGE>'
            + '<OR.BRANCHIMAGESMALL>' + dbo.fn_FormatXMLChars(isnull(BR.ImageSmall,'')) + '</OR.BRANCHIMAGESMALL>'
            + '<OR.BREAKDOWNAMTFUNDED>' + dbo.fn_FormatCurrency(OD.BreakdownAmtFunded) + '</OR.BREAKDOWNAMTFUNDED>'
            + '<OR.BREAKDOWNAMTINVOICED>' + dbo.fn_FormatCurrency(OD.BreakdownAmtInvoiced) + '</OR.BREAKDOWNAMTINVOICED>'
            + '<OR.BREAKDOWNBOOKINGTOTAL>' + dbo.fn_FormatCurrency(OD.BreakdownBookingTotal) + '</OR.BREAKDOWNBOOKINGTOTAL>'
            + '<OR.BREAKDOWNEQTOTAL>' + dbo.fn_FormatCurrency(OD.EquipmentTotal) + '</OR.BREAKDOWNEQTOTAL>'
            + '<OR.BREAKDOWNFUNDINGFINANCED>' + dbo.fn_FormatCurrency(OD.PaperCost) + '</OR.BREAKDOWNFUNDINGFINANCED>'
            + '<OR.BREAKDOWNFUNDEDRATE>' + case when isnull(OD.PaperRate ,0) = 0 then '' else dbo.fn_formatnumber(OD.PaperRate,5) end + '</OR.BREAKDOWNFUNDEDRATE>'
            + '<OR.BREAKDOWNHOUSE>' + dbo.fn_FormatCurrency(OD.BreakdownHouse) + '</OR.BREAKDOWNHOUSE>'
            + '<OR.BUSINESS>' + dbo.fn_FormatXMLChars(isnull(BU.Name ,'')) + '</OR.BUSINESS>'
            + '<OR.BUSINESSADDR1>' + dbo.fn_FormatXMLChars(isnull(BU.Address1 ,'')) + '</OR.BUSINESSADDR1>'
            + '<OR.BUSINESSADDR2>' + dbo.fn_FormatXMLChars(isnull(BU.Address2 ,'')) + '</OR.BUSINESSADDR2>'
            + '<OR.BUSINESSCITY>' + dbo.fn_FormatXMLChars(isnull(BU.City ,'')) + '</OR.BUSINESSCITY>'
            + '<OR.BUSINESSSTATE>' + dbo.fn_FormatXMLChars(isnull(BU.StateCode ,'')) + '</OR.BUSINESSSTATE>'
            + '<OR.BUSINESSPOSTALCODE>' + dbo.fn_FormatXMLChars(isnull(BU.PostalCode ,'')) + '</OR.BUSINESSPOSTALCODE>'
            + '<OR.BUSINESSPHONE>' + dbo.fn_FormatPhoneNumber(BU.Phone) + '</OR.BUSINESSPHONE>'
            + '<OR.BUSINESSFAX>' + dbo.fn_FormatPhoneNumber(BU.PhoneFax) + '</OR.BUSINESSFAX>'
            + '<OR.BUSINESSIMAGELARGE>' + dbo.fn_FormatXMLChars(isnull(BU.ImageLarge,'')) + '</OR.BUSINESSIMAGELARGE>'
            + '<OR.BUSINESSIMAGESMALL>' + dbo.fn_FormatXMLChars(isnull(BU.ImageSmall,'')) + '</OR.BUSINESSIMAGESMALL>'
            + '<OR.BUYTOTAL>' + dbo.fn_FormatCurrency((SELECT SUM(ISNULL(BuyPrice,0) * Quantity) FROM SNOrderLine with (nolock) WHERE ISNULL(ServiceInd,0) = 0 AND OrderID = OD.OrderID)) + '</OR.BUYTOTAL>'
            + '<OR.BUYTOTALPCT>' + dbo.fn_FormatCurrency(((SELECT SUM(ISNULL(BuyPrice,0) * Quantity) FROM SNOrderLine with (nolock) WHERE ISNULL(ServiceInd,0) = 0 AND OrderID = OD.OrderID) + OD.CSMPPCTAmt)) + '</OR.BUYTOTALPCT>'
            + '<OR.COMMTOTAL>' + dbo.fn_FormatCurrency((SELECT SUM(ISNULL(EarnedCommAmt,0)) FROM SNSRCommEarned with (nolock) WHERE OrderID = OD.OrderID)) + '</OR.COMMTOTAL>'
            + '<OR.COMMPRIMARYREPTOTAL>' + dbo.fn_FormatCurrency((SELECT SUM(ISNULL(EarnedCommAmt,0)) FROM SNSRCommEarned with (nolock) WHERE OrderID = OD.OrderID AND UserID = OD.SalesRepUserID)) + '</OR.COMMPRIMARYREPTOTAL>'
            + '<OR.CREDITAPPFCO>' + dbo.fn_FormatXMLChars(replace(isnull(CFC.RPTName,''),'_',' ')) + '</OR.CREDITAPPFCO>'
            + '<OR.CREDITAPPFCOADDRESSONELINE>' + dbo.fn_FormatXMLChars(case when len(isnull(CFC.RPTCity,'')) > 0 then isnull(CFC.RPTAddress1,'') + case when LEN(isnull(CFC.RPTAddress2,'')) > 0 then ' ' + isnull(CFC.RPTAddress2,'') else '' end  + ', ' +  isnull(CFC.RPTCity,'') + ', ' + isnull(CFC.RPTState,'') + ' ' + isnull(CFC.RPTZip,'') else '' end) + '</OR.CREDITAPPFCOADDRESSONELINE>'
            + '<OR.CREDITAPPFCOADDRESS1>' + dbo.fn_FormatXMLChars(isnull(CFC.RPTAddress1,'')) + '</OR.CREDITAPPFCOADDRESS1>'
            + '<OR.CREDITAPPFCOADDRESS2>' + dbo.fn_FormatXMLChars(isnull(CFC.RPTAddress2,'')) + '</OR.CREDITAPPFCOADDRESS2>'
            + '<OR.CREDITAPPFCOCITY>' + dbo.fn_FormatXMLChars(isnull(CFC.RPTCity,'')) + '</OR.CREDITAPPFCOCITY>'
            + '<OR.CREDITAPPFCOSTATE>' + dbo.fn_FormatXMLChars(isnull(CFC.RPTState,'')) + '</OR.CREDITAPPFCOSTATE>'
            + '<OR.CREDITAPPFCOZIP>' + dbo.fn_FormatXMLChars(isnull(CFC.RPTZip,'')) + '</OR.CREDITAPPFCOZIP>'
            + '<OR.CSMPAMTALL>' + dbo.fn_FormatCurrency((OD.SRCommCSMPCreditValue + OD.CSMPPCTAmt)) + '</OR.CSMPAMTALL>'
            + '<OR.CSMPCONTRACT>' + dbo.fn_FormatXMLChars(isnull(OD.SRCommCSMPContractNbr,'')) + '</OR.CSMPCONTRACT>'
            + '<OR.CSMPCREDITAMT>' + dbo.fn_FormatCurrency(OD.SRCommCSMPCreditValue) + '</OR.CSMPCREDITAMT>'
            + '<OR.CSMPCREDITNAME>' + case when OD.SRCommCSMPLevelID = -100 then 'Custom' else case when  OD.SRCommCSMPLevelID = -102 then 'Strategic' else dbo.fn_FormatXMLChars(isnull(CSMP.LevelName,'')) end end  + '</OR.CSMPCREDITNAME>'
            + '<OR.CURRENTMONTHLYCOST>' + case when isnull(OD.CurrentMonthlyCost,0) = 0 then '' else dbo.fn_FormatCurrency(isnull(OD.CurrentMonthlyCost,0)) end + '</OR.CURRENTMONTHLYCOST>'
            + '<OR.CUSTOMERPO>' + dbo.fn_FormatXMLChars(isnull(OD.CustomerPO,'')) + '</OR.CUSTOMERPO>'
            + '<OR.CUSTOMERUPGRADEX>' + case when isnull(OD.CustomerUpgradeind,0) = -1 then 'X' else '' end + '</OR.CUSTOMERUPGRADEX>'
            + '<OR.DEAR>' + dbo.fn_FormatXMLChars(isnull(OD.Dear,'')) + '</OR.DEAR>'
            + '<OR.DELIVERYFEEELEVATORX>' + case when isnull(OD.ElevatorInd,0) = -1 then 'X' else '' end + '</OR.DELIVERYFEEELEVATORX>'
            + '<OR.DELIVERYFEENBRFLOORS>' + dbo.fn_formatnumber(OD.DeliveryNbrFloors,0) + '</OR.DELIVERYFEENBRFLOORS>'
            + '<OR.DELIVERYMETHOD>' + dbo.fn_FormatXMLChars(isnull((select stuff((select '; ' + isnull(Method,'') from SNDeliveryJob with (nolock) where OrderID = OD.OrderID order by DeliveryJobCount for xml path('')),1,2,'')),'')) + '</OR.DELIVERYMETHOD>'
            + '<OR.DMACCESSORYPRICE>' + dbo.fn_FormatCurrency(isnull(OD.DMTotalAddFeesAmt,0)) + '</OR.DMACCESSORYPRICE>'
            + '<OR.DMDOWNPAYMENT>' + dbo.fn_FormatCurrency(isnull(OD.DMDownPaymentAmt,0)) + '</OR.DMDOWNPAYMENT>'
            + '<OR.DMDOWNPAYMENTDT>' + dbo.fn_FormatDate(OD.DTClosed,3,0,0) + '</OR.DMDOWNPAYMENTDT>'
            + '<OR.DMPAYMENTTERM>' + dbo.fn_FormatXMLChars(isnull(DMB.Name,'')) + '</OR.DMPAYMENTTERM>'
            + '<OR.DMPRIMARYPRICE>' + dbo.fn_FormatCurrency(isnull(OD.DMTotalServicesAmt,0)) + '</OR.DMPRIMARYPRICE>'
            + '<OR.DMSALESTAX>' + dbo.fn_FormatCurrency(isnull(OD.DMTotalSalesTaxAmt,0)) + '</OR.DMSALESTAX>'
            + '<OR.DMSUBTOTAL>' + dbo.fn_FormatCurrency(isnull(OD.DMTotalOrderAmt,0)) + '</OR.DMSUBTOTAL>'
            + '<OR.DMSUMSERVICES>' + dbo.fn_FormatCurrency(isnull((select sum(case when s.Type = 'P' then l.TotalSellAmt else 0 end) from SNOrderDMLine l with (nolock) join SNDMServices s with (nolock) on s.DMServiceID = l.DMServiceID where l.OrderID = OD.OrderID),0)) + '</OR.DMSUMSERVICES>'
            + '<OR.DMSUMFEES>' + dbo.fn_FormatCurrency(isnull((select sum(case when s.Type <> 'P' then l.TotalSellAmt else 0 end) from SNOrderDMLine l with (nolock) join SNDMServices s with (nolock) on s.DMServiceID = l.DMServiceID where l.OrderID = OD.OrderID),0)) + '</OR.DMSUMFEES>'
            + '<OR.DMTOTAL>' + dbo.fn_FormatCurrency(isnull(OD.DMTotalSalesTaxAmt,0) + isnull(OD.DMTotalOrderAmt,0)) + '</OR.DMTOTAL>'
            + '<OR.DOCFEE>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(LP.DocFee,0))  end + '</OR.DOCFEE>'
            + '<OR.DTCDAY>' + cast(datepart(dd,OD.DTClosed) as nvarchar) + '</OR.DTCDAY>'
            + '<OR.DTCMONTH>' + cast(datepart(mm,OD.DTClosed) as nvarchar) + '</OR.DTCMONTH>'
            + '<OR.DTCMONTHNAME>' + datename(mm,OD.DTClosed) + '</OR.DTCMONTHNAME>'
            + '<OR.DTCLOSED>' + dbo.fn_FormatDate(OD.DTClosed,3,0,0)  + '</OR.DTCLOSED>'
            + '<OR.DTCYEAR>' + cast(datepart(yy,OD.DTClosed) as nvarchar) + '</OR.DTCYEAR>'
            + '<OR.DTPROPOSAL>' + dbo.fn_FormatDate(PR.DTProposal,3,0,0)  + '</OR.DTPROPOSAL>'
            + '<OR.EOTFIXPCTX>' + case when isnull(LP.isEOT_FixedPCT,0) = -1 then 'X' else '' end + '</OR.EOTFIXPCTX>'
            + '<OR.EOTFMVX>' + case when isnull(LP.isEOT_FMV,0) = -1 then 'X' else '' end + '</OR.EOTFMVX>'
            + '<OR.EOTOPTION>' + case when isnull(LP.isEOT_FMV,0) = -1 then 'FMV' else case when isnull(LP.isEOT_BuckOut,0) = -1 then '$Out' else case when isnull(LP.isEOT_FixedPCT,0) = -1 then 'Fixed PCT' else case when isnull(LP.isEOT_NoOption,0) = -1 then 'No Option' else '' end end end end + '</OR.EOTOPTION>'
            + '<OR.EOTOUTX>' + case when isnull(LP.isEOT_BuckOut,0) = -1 then 'X' else '' end + '</OR.EOTOUTX>'
            + '<OR.EXPCLOSEDT>' + dbo.fn_FormatDate(PR.DTExpectedClose,3,0,0)  + '</OR.EXPCLOSEDT>'
            + '<OR.FCOAPPAPPROVEDATE>' + dbo.fn_FormatDate(OD.FCOApprovedDT,3,0,0)  + '</OR.FCOAPPAPPROVEDATE>'
            + '<OR.FCOAPPNBR>' + dbo.fn_FormatXMLChars(isnull(OD.FCOAppNbr ,'')) + '</OR.FCOAPPNBR>'
            + '<OR.FCOAPPRVALIDTHRUDATE>' + dbo.fn_FormatDate(OD.FCOApprovalValidThruDT,3,0,0)  + '</OR.FCOAPPRVALIDTHRUDATE>'
            + '<OR.FCOAPPLDATE>' + dbo.fn_FormatDate(OD.FCOApplicationDT,3,0,0)  + '</OR.FCOAPPLDATE>'
            + '<OR.FCOAPPRCONDITIONS>' + dbo.fn_FormatXMLChars(cast(isnull(OD.FCOConditions ,'') as nvarchar(max))) + '</OR.FCOAPPRCONDITIONS>'
            + '<OR.FCOADDRESS1>' + dbo.fn_FormatXMLChars(isnull(FC.RPTAddress1,'')) + '</OR.FCOADDRESS1>'
            + '<OR.FCOADDRESS2>' + dbo.fn_FormatXMLChars(isnull(FC.RPTAddress2,'')) + '</OR.FCOADDRESS2>'
            + '<OR.FCOCITY>' + dbo.fn_FormatXMLChars(isnull(FC.RPTCity,'')) + '</OR.FCOCITY>'
            + '<OR.FCOSTATE>' + dbo.fn_FormatXMLChars(isnull(FC.RPTState,'')) + '</OR.FCOSTATE>'
            + '<OR.FCOZIP>' + dbo.fn_FormatXMLChars(isnull(FC.RPTZip,'')) + '</OR.FCOZIP>'
            + '<OR.FCOPHONENBR>' + dbo.fn_FormatPhoneNumber(FC.AppPhoneNbr) + '</OR.FCOPHONENBR>'
            + '<OR.FCOLEGALNAME>' + dbo.fn_FormatXMLChars(case when isnull(OD.FCOLegalName,'') = '' then case when isnull(OD.BillingCustomerName,'') = '' then  isnull(BCU.RPTName ,'') else OD.BillingCustomerName end else OD.FCOLegalName end) + '</OR.FCOLEGALNAME>'
            + '<OR.FCOLEGALNAMEASIS>' + dbo.fn_FormatXMLChars(isnull(OD.FCOLegalName ,'')) + '</OR.FCOLEGALNAMEASIS>'
            + '<OR.FCONAME>' + dbo.fn_FormatXMLChars(replace(isnull(CO.Name,''),'_',' ')) + '</OR.FCONAME>'
            + '<OR.GENDAY>' + cast(datepart(dd,getdate()) as nvarchar) + '</OR.GENDAY>'
            + '<OR.GENMONTH>' + cast(datepart(mm,getdate()) as nvarchar) + '</OR.GENMONTH>'
            + '<OR.GENMONTHNAME>' + datename(mm,getdate()) + '</OR.GENMONTHNAME>'
            + '<OR.GENYEAR>' + cast(datepart(yy,getdate()) as nvarchar) + '</OR.GENYEAR>'
            + '<OR.HASCUSTOMEREQX>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and OwnershipInd = 'C') then 'X' else '' end + '</OR.HASCUSTOMEREQX>'
            + '<OR.HASDEALEREQX>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and isnull(OwnershipInd,'D') = 'D' and BPProductCategoryID not in (select ProductCategoryID from SNProductCategory with (nolock) where isnull(IsNotMachine,0) = -1)) then 'X' else '' end + '</OR.HASDEALEREQX>'
            + '<OR.HASEXISTINGEQLABEL>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and isnull(OwnershipInd,'') = 'D' and BPProductCategoryID not in (select ProductCategoryID from SNProductCategory with (nolock) where isnull(IsNotMachine,0) = -1)) then 'Existing EQ' else '' end + '</OR.HASEXISTINGEQLABEL>'
            + '<OR.HASEXISTINGEQX>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and isnull(OwnershipInd,'') = 'D' and BPProductCategoryID not in (select ProductCategoryID from SNProductCategory with (nolock) where isnull(IsNotMachine,0) = -1)) then 'X' else '' end + '</OR.HASEXISTINGEQX>'
            + '<OR.HASNEWEQX>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and isnull(OwnershipInd,'') = '' and isnull(ServiceInd,0) = 0) then 'X' else '' end + '</OR.HASNEWEQX>'
            + '<OR.HASSERVICEX>' + case when exists(select * from SNOBDServiceLine with (nolock) where OBDID = OD.OrderID) then 'X' else '' end + '</OR.HASSERVICEX>'
            + '<OR.HASSERVICEXPTONLY>' + case when isnull(BT.IncludeInLease,0) = -1 then case when exists(select * from SNOBDServiceLine with (nolock) where OBDID = OD.OrderID) then 'X' else '' end else '' end + '</OR.HASSERVICEXPTONLY>'
            + '<OR.HASSOFTWAREX>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and BPProductCategoryID in (select ProductCategoryID from SNProductCategory with (nolock) where isnull(IsNotMachine,0) = -1)) then 'X' else '' end + '</OR.HASSOFTWAREX>'
            + '<OR.HASUSEDEQX>' + case when exists(select * from SNOrderLine with (nolock) where OrderID = OD.OrderID and isnull(Condition,'') = 'U') then 'X' else '' end + '</OR.HASUSEDEQX>'
            + '<OR.IMMEDIATEMANAGERNAME>' +  dbo.fn_FormatXMLChars(isnull((select top 1 isnull(pr.FirstName,'') + ' ' + case when isnull(pr.MiddleName,'') <> '' then pr.MiddleName + ' ' else '' end + isnull(pr.LastName,'') from SNUser u with (nolock) join SNHierarchyNode p with (nolock) on p.ObjectKey = u.UserID join SNHierarchyNode c with (nolock) on c.ParentHierarchyNodeID = p.HierarchyNodeID join SNPerson pr with (nolock) on pr.PersonID = u.PersonID where c.ObjectKey = OD.SalesRepUserID),isnull(SMP.FirstName,'') + ' ' + case when isnull(SMP.MiddleName,'') <> '' then  SMP.MiddleName + ' ' else '' end + isnull(SMP.LastName,''))) + '</OR.IMMEDIATEMANAGERNAME>'
            + '<OR.ITPDEALERCOST>' + dbo.fn_FormatCurrency(isnull(OD.ITPTotalDealerCostAmt,0)) + '</OR.ITPDEALERCOST>'
            + '<OR.ITPDOWNPAYMENT>' + dbo.fn_FormatCurrency(isnull(OD.ITPDownPaymentAmt,0)) + '</OR.ITPDOWNPAYMENT>'
            + '<OR.ITPDOWNPAYMENTDT>' + dbo.fn_FormatDate(OD.DTClosed,3,0,0) + '</OR.ITPDOWNPAYMENTDT>'
            + '<OR.ITPGP>' + dbo.fn_FormatCurrency(isnull(OD.ITPTotalGP,0)) + '</OR.ITPGP>'
            + '<OR.ITPPAYMENT>' + dbo.fn_FormatCurrency(case when isnull(IPB.IsInLeaseInd,0) = -1 then isnull(OD.LeaseFactor ,0) * isnull(OD.ITPTotalSellAmt,0) else isnull(OD.ITPTotalSellAmt,0) end) + '</OR.ITPPAYMENT>'
            + '<OR.ITPPAYMENTTERM>' + dbo.fn_FormatXMLChars(isnull(IPB.Name,'')) + '</OR.ITPPAYMENTTERM>'
            + '<OR.ITPTOTALGPPCT>' + dbo.fn_FormatNumber(OD.ITPTotalGPPCT * 100,2) + '%' + '</OR.ITPTOTALGPPCT>'
            + '<OR.ITPREPCOST>' + dbo.fn_FormatCurrency(isnull(OD.ITPTotalRepCostAmt,0)) + '</OR.ITPREPCOST>'
            + '<OR.ITPSELLCOST>' + dbo.fn_FormatCurrency(isnull(OD.ITPTotalSellAmt,0)) + '</OR.ITPSELLCOST>'
            + '<OR.LEASEACHX>' + case when isnull(OD.LeaseACHInd,0) = -1 then 'X' else '' end + '</OR.LEASEACHX>'
            + '<OR.LEASEACHXNO>' + case when isnull(OD.LeaseACHInd,0) = -1 then '' else 'X' end + '</OR.LEASEACHXNO>'
            + '<OR.LEASEACHBANKACCTNBR>' + dbo.fn_FormatXMLChars(isnull(OD.LeaseACHBankAcctNbr ,'')) + '</OR.LEASEACHBANKACCTNBR>'
            + '<OR.LEASEACHBANKROUTENBR>' + dbo.fn_FormatXMLChars(isnull(OD.LeaseACHBankRouteNbr ,'')) + '</OR.LEASEACHBANKROUTENBR>'
            + '<OR.LEASEADJUSTTYPES>' + dbo.fn_FormatXMLChars(isnull(stuff((select ', ' + Name from SNLeaseAdjustType with (nolock) where ',' + isnull(OD.ActiveLeaseAdjustTypeIDs,'') + ',' like '%,' + cast(LeaseAdjustTypeID as nvarchar) + ',%' for xml path('')),1,2,''),'')) + '</OR.LEASEADJUSTTYPES>'
            + '<OR.LEASEBASEFACTOR>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else isnull(nullif(dbo.fn_formatnumber((select RateFactor from SNLeasePrice with (nolock) where LeasePriceID = OD.LeaseFactorSelect),5),'0.00000'),'') end + '</OR.LEASEBASEFACTOR>'
            + '<OR.LEASECOMMENCEDT>' + dbo.fn_FormatDate(OD.LeaseCommenceDT,3,0,0) + '</OR.LEASECOMMENCEDT>'
            + '<OR.LEASEDCAX>' + case when isnull(OD.isDCAInd,0) = -1 then 'X' else '' end + '</OR.LEASEDCAX>'
            + '<OR.LEASEDCAXNO>' + case when isnull(OD.isDCAInd,0) = -1 then '' else 'X' end + '</OR.LEASEDCAXNO>'
            + '<OR.LEASEFACTOR>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.LeaseFactor ,0) = 0 then '' else cast(OD.LeaseFactor as nvarchar) end end + '</OR.LEASEFACTOR>'
            + '<OR.LEASEFIRSTPYMTDUEDT>' + dbo.fn_FormatDate(OD.LeaseFirstPymtDueDT,3,0,0) + '</OR.LEASEFIRSTPYMTDUEDT>'
            + '<OR.LEASEFIRSTUSAGEDT>' + dbo.fn_FormatDate(OD.LeaseFirstUsageDT,3,0,0) + '</OR.LEASEFIRSTUSAGEDT>'
            + '<OR.LEASEFIRSTUSAGEPERIOD>' + substring(dbo.fn_FormatDate(OD.LeaseFirstUsageDT,3,0,0),1,5) + ' - ' + substring(dbo.fn_FormatDate(OD.LeaseFirstPymtDueDT,3,0,0),1,5) + '</OR.LEASEFIRSTUSAGEPERIOD>'
            + '<OR.LEASEINTERIMDAYS>' + dbo.fn_formatnumber(isnull(OD.NbrInterimRentDays,0),0) + '</OR.LEASEINTERIMDAYS>'
            + '<OR.LEASEINTERIMEQPERDIEM>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(round((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30, 2),0))  end + '</OR.LEASEINTERIMEQPERDIEM>'
            + '<OR.LEASEINTERIMEQ25RENT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((isnull(round((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30, 2),0) * isnull(OD.NbrInterimRentDays,0)) * .25)  end + '</OR.LEASEINTERIMEQ25RENT>'
            + '<OR.LEASEINTERIMEQRENT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(round((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30, 2),0) * isnull(OD.NbrInterimRentDays,0))  end + '</OR.LEASEINTERIMEQRENT>'
            + '<OR.LEASEINTERIMPERDIEM>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(round(isnull(OD.PaymentAmtMonthlyFin,0) / 30, 2),0))  end + '</OR.LEASEINTERIMPERDIEM>'
            + '<OR.LEASEINTERIMRENT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((isnull(round((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30, 2),0) + isnull(round((isnull(OD.PaymentAmtMonthlyFin,0) / 30) - ((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30), 2),0)) * isnull(OD.NbrInterimRentDays,0))  end + '</OR.LEASEINTERIMRENT>'
            + '<OR.LEASEINTERIMRENTLESS25>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(((isnull(round((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30, 2),0) + isnull(round((isnull(OD.PaymentAmtMonthlyFin,0) / 30) - ((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30), 2),0)) * isnull(OD.NbrInterimRentDays,0)) - round(((isnull(round((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30, 2),0) * isnull(OD.NbrInterimRentDays,0)) * .25),2))  end + '</OR.LEASEINTERIMRENTLESS25>'
            + '<OR.LEASEINTERIMSVCPERDIEM>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(round((isnull(OD.PaymentAmtMonthlyFin,0) / 30) - ((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30), 2),0))  end + '</OR.LEASEINTERIMSVCPERDIEM>'
            + '<OR.LEASEINTERIMSVCRENT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(isnull(round((isnull(OD.PaymentAmtMonthlyFin,0) / 30) - ((isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) / 30), 2),0) * isnull(OD.NbrInterimRentDays,0))  end + '</OR.LEASEINTERIMSVCRENT>'
            + '<OR.LEASEINSTALLDT>' + dbo.fn_FormatDate(OD.InstallDT,3,0,0) + '</OR.LEASEINSTALLDT>'
            + '<OR.LEASEMASTERAGREEMENTNBR>' + dbo.fn_FormatXMLChars(isnull(OD.LeaseMasterAgreementNbr ,'')) + '</OR.LEASEMASTERAGREEMENTNBR>'
            + '<OR.LEASEPRICELEVEL>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatXMLChars(isnull(LPL.Name,'')) end + '</OR.LEASEPRICELEVEL>'
            + '<OR.LEASEPRODUCT>' + dbo.fn_FormatXMLChars(isnull(LP.Name ,'')) + '</OR.LEASEPRODUCT>'
            + '<OR.LEASEPYMTINCLUDES>' + dbo.fn_FormatXMLChars(case when isnull(SBT.FundedInLeaseInd,0) = -1 or isnull(IPB.IsInLeaseInd,0) = -1 or isnull(BTB.IsInLeaseInd,0) = -1 or isnull(DMB.IsInLeaseInd,0) = -1 then '* Payment includes ' + case when isnull(SBT.FundedInLeaseInd,0) = -1 then 'IT Services' else '' end + case when isnull(IPB.IsInLeaseInd,0) = -1 then case when isnull(SBT.FundedInLeaseInd,0) = -1 then ' and ' else '' end + 'IT Products' else '' end + case when isnull(BTB.IsInLeaseInd,0) = -1 then case when isnull(SBT.FundedInLeaseInd,0) = -1 or isnull(IPB.IsInLeaseInd,0) = -1 then ' and ' else '' end + 'Block of Time' else '' end + case when isnull(DMB.IsInLeaseInd,0) = -1 then case when isnull(SBT.FundedInLeaseInd,0) = -1 or isnull(IPB.IsInLeaseInd,0) = -1 or isnull(BTB.IsInLeaseInd,0) = -1 then ' and ' else '' end + 'Document Management' else '' end else '' end) + '</OR.LEASEPYMTINCLUDES>'
            + '<OR.LEASESCHEDULENBR>' + dbo.fn_FormatXMLChars(isnull(OD.LeaseScheduleNbr ,'')) + '</OR.LEASESCHEDULENBR>'
            + '<OR.LEASESERVICEPAYMENT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(case when BT.IncludeInLease = -1 then isnull(OD.MaintMonthValueActual,0) else 0 end)  end + '</OR.LEASESERVICEPAYMENT>'
            + '<OR.LEASESECURITYDEPAMT>' + dbo.fn_FormatCurrency(isnull(OD.LeaseSecurityDepAmt,0)) + '</OR.LEASESECURITYDEPAMT>'
            + '<OR.LEASETAXEXEMPTX>' + case when isnull(OD.isTaxExemptInd,0) = -1 then 'X' else '' end + '</OR.LEASETAXEXEMPTX>'
            + '<OR.LEASETAXEXEMPTXNO>' + case when isnull(OD.isTaxExemptInd,0) = -1 then '' else 'X' end + '</OR.LEASETAXEXEMPTXNO>'
            + '<OR.LEASETAXEXEMPTYESNO>' + case when isnull(OD.isTaxExemptInd,0) = -1 then 'Yes' else 'No' end + '</OR.LEASETAXEXEMPTYESNO>'
            + '<OR.MAINTBASEPAYMENT>' + dbo.fn_FormatCurrency(OD.MaintBasePayment) + '</OR.MAINTBASEPAYMENT>'
            + '<OR.MAINTBASEPAYMENTY2>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatCurrency(OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) end + '</OR.MAINTBASEPAYMENTY2>'
            + '<OR.MAINTBASEPAYMENTY3>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatCurrency((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) end + '</OR.MAINTBASEPAYMENTY3>'
            + '<OR.MAINTBASEPAYMENTY4>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatCurrency(((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) * (OD.SPM_Y4EscalatePCT / 100)) end + '</OR.MAINTBASEPAYMENTY4>'
            + '<OR.MAINTBASEPAYMENTY5>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatCurrency((((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) * (OD.SPM_Y4EscalatePCT / 100)) * (OD.SPM_Y5EscalatePCT / 100)) end + '</OR.MAINTBASEPAYMENTY5>'
            + '<OR.MAINTBASEPAYMENTY6>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatCurrency(((((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) * (OD.SPM_Y4EscalatePCT / 100)) * (OD.SPM_Y5EscalatePCT / 100)) * (OD.SPM_Y6EscalatePCT / 100)) end + '</OR.MAINTBASEPAYMENTY6>'
            + '<OR.MAINTBASEPAYMENTY2PROJECTED>' + dbo.fn_FormatCurrency(OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) + '</OR.MAINTBASEPAYMENTY2PROJECTED>'
            + '<OR.MAINTBASEPAYMENTY3PROJECTED>' + dbo.fn_FormatCurrency((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) + '</OR.MAINTBASEPAYMENTY3PROJECTED>'
            + '<OR.MAINTBASEPAYMENTY4PROJECTED>' + dbo.fn_FormatCurrency(((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) * (CT.Y4EscalatePCT / 100)) + '</OR.MAINTBASEPAYMENTY4PROJECTED>'
            + '<OR.MAINTBASEPAYMENTY5PROJECTED>' + dbo.fn_FormatCurrency((((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) * (CT.Y4EscalatePCT / 100)) * (CT.Y5EscalatePCT / 100)) + '</OR.MAINTBASEPAYMENTY5PROJECTED>'
            + '<OR.MAINTBASEPAYMENTY6PROJECTED>' + dbo.fn_FormatCurrency(((((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) * (CT.Y4EscalatePCT / 100)) * (CT.Y5EscalatePCT / 100)) * (CT.Y6EscalatePCT / 100)) + '</OR.MAINTBASEPAYMENTY6PROJECTED>'
            + '<OR.MAINTBILLINGCYCLE>' + dbo.fn_FormatXMLChars(isnull(BT.Name,'')) + '</OR.MAINTBILLINGCYCLE>'
            + '<OR.MAINTBILLINGCYCLELEASE>' + dbo.fn_FormatXMLChars(case when isnull(BT.IncludeInLease,0) = -1 then case LP.PaymentFrequency when 1 then 'Annually' when 2 then 'Semi-Annually' when 4 then 'Quarterly' else 'Monthly' end else isnull(BT.Name,'') end) + '</OR.MAINTBILLINGCYCLELEASE>'
            + '<OR.MAINTBILLINGCYCLEOTHER>' + dbo.fn_FormatXMLChars(isnull(BT.OtherName,'')) + '</OR.MAINTBILLINGCYCLEOTHER>'
            + '<OR.MAINTBILLINGCYCLEOTHERCAPS>' + dbo.fn_FormatXMLChars(upper(isnull(BT.OtherName,''))) + '</OR.MAINTBILLINGCYCLEOTHERCAPS>'
            + '<OR.MAINTCONTRACTDESC>' + dbo.fn_FormatXMLChars(isnull(CT.Description,'')) + '</OR.MAINTCONTRACTDESC>'
            + '<OR.MAINTCONTRACTLEGALTEXT>' + dbo.fn_FormatXMLChars(isnull(CT.LegalText,'')) + '</OR.MAINTCONTRACTLEGALTEXT>'
            + '<OR.MAINTCONTRACTTYPE>' + dbo.fn_FormatXMLChars(isnull(CT.Name,'')) + '</OR.MAINTCONTRACTTYPE>'
            + '<OR.MAINTENDDATEV2>' + (case when OD.MaintStartDateV2 > 2 then dbo.fn_FormatDate(DATEADD(M,OD.MaintNumMonths,DATEADD(D,OD.MaintStartDateV2,'12/30/1899')),3,0,0) else '' end)  + '</OR.MAINTENDDATEV2>'
            + '<OR.MAINTFIXEDANNUAL>' + dbo.fn_FormatCurrency((select sum(BundleQuantity * FixedAmount) from SNOrderLine with (nolock) where OrderID = OD.OrderID)) + '</OR.MAINTFIXEDANNUAL>'
            + '<OR.MAINTNUMMONTHS>' + cast(isnull(OD.MaintNumMonths ,'') as nvarchar) + '</OR.MAINTNUMMONTHS>'
            + '<OR.MAINTOVERBILLINGCYCLE>' + dbo.fn_FormatXMLChars(case when OD.MaintOverBillingCycle = -1 then isnull(BT.Name,'') else isnull(OBT.Name,'') end) + '</OR.MAINTOVERBILLINGCYCLE>'
            + '<OR.MAINTOVERBILLINGCYCLEOTHER>' + dbo.fn_FormatXMLChars(case when OD.MaintOverBillingCycle = -1 then isnull(BT.OtherName,'') else isnull(OBT.OtherName,'') end) + '</OR.MAINTOVERBILLINGCYCLEOTHER>'
            + '<OR.MAINTOVERBILLINGCYCLEOTHERCAPS>' + dbo.fn_FormatXMLChars(upper(case when OD.MaintOverBillingCycle = -1 then isnull(BT.OtherName,'') else isnull(OBT.OtherName,'') end)) + '</OR.MAINTOVERBILLINGCYCLEOTHERCAPS>'
            + '<OR.MAINTSTARTDATE>' + dbo.fn_FormatDate(OD.MaintStartDate,3,0,0) + '</OR.MAINTSTARTDATE>'
            + '<OR.MAINTSTARTDATEV2>' + (case when OD.MaintStartDateV2 > 1 then dbo.fn_FormatDate(DATEADD(D,OD.MaintStartDateV2,'12/30/1899'),3,0,0) else '' end)  + '</OR.MAINTSTARTDATEV2>'
            + '<OR.MAINTSTARTDATEV2METRO>' + (case when OD.MaintStartDateV2 > 1 then dbo.fn_FormatDate(DATEADD(D,OD.MaintStartDateV2,'12/30/1899'),3,0,0) else 'Install Date' end)  + '</OR.MAINTSTARTDATEV2METRO>'
            + '<OR.MAINTSTARTDATEY2>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatDate(dateadd(yy,1,OD.MaintStartDate),3,0,0) end + '</OR.MAINTSTARTDATEY2>'
            + '<OR.MAINTSTARTDATEY3>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatDate(dateadd(yy,2,OD.MaintStartDate),3,0,0) end + '</OR.MAINTSTARTDATEY3>'
            + '<OR.MAINTSTARTDATEY4>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatDate(dateadd(yy,3,OD.MaintStartDate),3,0,0) end + '</OR.MAINTSTARTDATEY4>'
            + '<OR.MAINTSTARTDATEY5>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatDate(dateadd(yy,4,OD.MaintStartDate),3,0,0) end + '</OR.MAINTSTARTDATEY5>'
            + '<OR.MAINTSTARTDATEY6>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else dbo.fn_FormatDate(dateadd(yy,5,OD.MaintStartDate),3,0,0) end + '</OR.MAINTSTARTDATEY6>'
            + '<OR.MAINTSTARTDATEY2PROJECTED>' + dbo.fn_FormatDate(dateadd(yy,1,OD.MaintStartDate),3,0,0) + '</OR.MAINTSTARTDATEY2PROJECTED>'
            + '<OR.MAINTSTARTDATEY3PROJECTED>' + dbo.fn_FormatDate(dateadd(yy,2,OD.MaintStartDate),3,0,0) + '</OR.MAINTSTARTDATEY3PROJECTED>'
            + '<OR.MAINTSTARTDATEY4PROJECTED>' + dbo.fn_FormatDate(dateadd(yy,3,OD.MaintStartDate),3,0,0) + '</OR.MAINTSTARTDATEY4PROJECTED>'
            + '<OR.MAINTSTARTDATEY5PROJECTED>' + dbo.fn_FormatDate(dateadd(yy,4,OD.MaintStartDate),3,0,0) + '</OR.MAINTSTARTDATEY5PROJECTED>'
            + '<OR.MAINTSTARTDATEY6PROJECTED>' + dbo.fn_FormatDate(dateadd(yy,5,OD.MaintStartDate),3,0,0) + '</OR.MAINTSTARTDATEY6PROJECTED>'
            + '<OR.MAINTTOTALBASEPAYMENT>' + dbo.fn_FormatCurrency(OD.MaintBasePayment * (12/isnull(BT.PaymentsPerYear,12))) + '</OR.MAINTTOTALBASEPAYMENT>'
            + '<OR.MGRAPPROVEDLABEL>' + case when isnull(OD.ApprovedByUserID,-1) < 0 then '' else case isnull(OD.ManagerApproved,0) when 1 then 'Approved By Manager' when 2 then 'Declined By Manager' else 'No Action By Manager' end + '(' + dbo.fn_FormatXMLChars((select isnull(cPR.FirstName,'') + ' ' + case when isnull(cPR.MiddleName,'') <> '' then cPR.MiddleName + ' ' else '' end + isnull(cPR.LastName,'') from SNUser cUS with (nolock) join SNPerson cPR with (nolock) on cPR.PersonID = cUS.PersonID where cUS.UserID = OD.ApprovedByUserID)) + ')' end + '</OR.MGRAPPROVEDLABEL>'
            + '<OR.MNSINDYESNO>' + case when isnull(OD.IsMNSInd,0) = -1 then 'Yes' else 'No' end + '</OR.MNSINDYESNO>'
            + '<OR.MNSINDYESX>' + case when isnull(OD.IsMNSInd,0) = -1 then 'X' else '' end + '</OR.MNSINDYESX>'
            + '<OR.MPSINDYESNO>' + case when isnull(OD.IsMPSInd,0) = -1 then 'Yes' else 'No' end + '</OR.MPSINDYESNO>'
            + '<OR.MPSINDYESX>' + case when isnull(OD.IsMPSInd,0) = -1 then 'X' else '' end + '</OR.MPSINDYESX>'
            + '<OR.NBRLEASEPYMTS>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.NbrLeasePymts,0) = 0 then '' else cast(OD.NbrLeasePymts as nvarchar) end end + '</OR.NBRLEASEPYMTS>'
            + '<OR.NBRLEASEPYMTSCAN>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.NbrLeasePymts,0) = 0 then '' else cast((isnull(LP.PaymentFrequency,12) * OD.NbrLeasePymts)/12 as nvarchar) end end + '</OR.NBRLEASEPYMTSCAN>'
            + '<OR.NBRPYMTSNBRDEF>' + case when isnull(OD.NbrLeasePymts + OD.NbrDeferredPymts,0) = 0 then '' else cast((OD.NbrLeasePymts + OD.NbrDeferredPymts) as nvarchar) end + '</OR.NBRPYMTSNBRDEF>'
            + '<OR.NBRPYMTSTBLW>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.NbrDeferredPymts,0) = 0 then case when isnull(OD.LeaseOverride,0) = -1 then dbo.fn_FormatNumber(isnull(OD.OverrideLeaseTerm,0),0) else case when isnull(OD.PaymentNbrFin,0) = 0 then '' else dbo.fn_FormatNumber(isnull(OD.NbrLeasePymts,0),0) end end else dbo.fn_FormatNumber(isnull(OD.NbrDeferredPymts,0),0) + ' @' + char(13) + case when isnull(OD.LeaseOverride,0) = -1 then dbo.fn_FormatNumber(isnull(OD.OverrideLeaseTerm,0) - isnull(OD.NbrDeferredPymts,0),0) else dbo.fn_FormatNumber(isnull(OD.PaymentNbrFin,0) - isnull(OD.NbrDeferredPymts,0),0) end + ' @' end end + '</OR.NBRPYMTSTBLW>'
            + '<OR.DSLSPYMTSUM>' 
            + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 
                    then '' 
                    else case when isnull(OD.NbrDeferredPymts,0) = 0 and isnull(LP.isDefStep,0) = 0 
                                then case when OD.PaymentAmtMonthlyFin = 0 then '' 
                                        else case when isnull(BT.IncludeInLease,0) = -1 
                                                    then dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) 
                                                    else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) 
                                            end 
                                    end 
                            when isnull(OD.NbrDeferredPymts,0) <> 0 and isnull(LP.isDefStep,0) = 0  
                                then '$0.00' + char(13) + case when isnull(BT.IncludeInLease,0) = -1  
                                                                then dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) 
                                                            else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) 
                                                        end 
                            when isnull(OD.NbrDeferredPymts,0) = 0 and isnull(LP.isDefStep,0) <> 0 
                                then cast(LP.DS1NbrPymts as nvarchar) + ' @ ' +  dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0) * LP.DS1PCTPymt) 
                                    + case when LP.DS2NbrPymts > 0 
                                            then ' then ' + case when LP.DS3NbrPymts > 0 
                                                                    then cast(LP.DS2NbrPymts as nvarchar) 
                                                                else cast(OD.NbrLeasePymts - LP.DS1NbrPymts as nvarchar)
                                                            end + ' @ ' +  dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0) * LP.DS2PCTPymt) 
                                            else '' 
                                    end 
                                    + case when LP.DS3NbrPymts > 0 
                                            then ' then ' + cast(OD.NbrLeasePymts - (LP.DS1NbrPymts + LP.DS2NbrPymts) as nvarchar) + ' @ ' 
                                                +  dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0) * LP.DS3PCTPymt) 
                                            else '' 
                                    end 
                            else '' 
                        end 
            end 
            + '</OR.DSLSPYMTSUM>'
            + '<OR.NEWCUSTOMER>' + case when isnull(OD.NewCustomerInd,0) = -1 then 'Yes' else 'No' end + '</OR.NEWCUSTOMER>'
            + '<OR.NEWCUSTOMERX>' + case when isnull(OD.NewCustomerInd,0) = -1 then 'X' else '' end + '</OR.NEWCUSTOMERX>'
            + '<OR.NEWPLACEMENTX>' + case when isnull(OD.NewPlacementInd,0) = -1 then 'X' else '' end + '</OR.NEWPLACEMENTX>'
            + '<OR.NOTE>' + dbo.fn_FormatXMLChars(ISNULL(cast(OD.Note as nvarchar(max)),'')) + '</OR.NOTE>'
            + '<OR.NUMMACHINECFG>' + dbo.fn_formatnumber(isnull((select sum(Quantity) from SNOrderLine with (nolock) where OrderID = OD.OrderID and isPrimaryInd = -1),0),0) + '</OR.NUMMACHINECFG>'
            + '<OR.ORDERID>' + cast(OD.OrderID as nvarchar) + '</OR.ORDERID>'
            + '<OR.OVEBILLFREQANX>' + case when OD.MaintOverBillingCycle = -1 and BT.PaymentsPerYear = 1 then 'X' else case when OBT.PaymentsPerYear = 1 then 'X'  else '' end end + '</OR.OVEBILLFREQANX>'
            + '<OR.OVEBILLFREQMOX>' + case when OD.MaintOverBillingCycle = -1 and BT.PaymentsPerYear = 12 then 'X' else case when OBT.PaymentsPerYear = 12 then 'X'  else '' end end + '</OR.OVEBILLFREQMOX>'
            + '<OR.OVEBILLFREQQTRX>' + case when OD.MaintOverBillingCycle = -1 and BT.PaymentsPerYear = 4 then 'X' else case when OBT.PaymentsPerYear = 4 then 'X'  else '' end end + '</OR.OVEBILLFREQQTRX>'
            + '<OR.OVEBILLFREQSAX>' + case when OD.MaintOverBillingCycle = -1 and BT.PaymentsPerYear = 2 then 'X' else case when OBT.PaymentsPerYear = 2 then 'X'  else '' end end + '</OR.OVEBILLFREQSAX>'
            + '<OR.OVERRIDECHARGEBACK>' + dbo.fn_FormatCurrency(OD.MaintTotalChargeback) + '</OR.OVERRIDECHARGEBACK>'
            + '<OR.PAYMENTAMTMONTHLYFIN>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end + '</OR.PAYMENTAMTMONTHLYFIN>'
            + '<OR.PAYMENTAMTMONTHLYFINNOSIGN>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else replace(dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin),'$','') end + '</OR.PAYMENTAMTMONTHLYFINNOSIGN>'
            + '<OR.PAYMENTAMTMONTHLYFINY2>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + (OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100))) end end + '</OR.PAYMENTAMTMONTHLYFINY2>'
            + '<OR.PAYMENTAMTMONTHLYFINY3>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + ((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100))) end end + '</OR.PAYMENTAMTMONTHLYFINY3>'
            + '<OR.PAYMENTAMTMONTHLYFINY4>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + (((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) * (OD.SPM_Y4EscalatePCT / 100))) end end + '</OR.PAYMENTAMTMONTHLYFINY4>'
            + '<OR.PAYMENTAMTMONTHLYFINY5>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + ((((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) * (OD.SPM_Y4EscalatePCT / 100)) * (OD.SPM_Y5EscalatePCT / 100))) end end + '</OR.PAYMENTAMTMONTHLYFINY5>'
            + '<OR.PAYMENTAMTMONTHLYFINY6>' + case when isnull(OD.SPM_BlendEscInd,0) = -1 then '' else case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + (((((OD.MaintBasePayment * (OD.SPM_Y2EscalatePCT / 100)) * (OD.SPM_Y3EscalatePCT / 100)) * (OD.SPM_Y4EscalatePCT / 100)) * (OD.SPM_Y5EscalatePCT / 100)) * (OD.SPM_Y6EscalatePCT / 100))) end end + '</OR.PAYMENTAMTMONTHLYFINY6>'
            + '<OR.PAYMENTAMTMONTHLYFINY2PROJECTED>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + (OD.MaintBasePayment * (CT.Y2EscalatePCT / 100))) end + '</OR.PAYMENTAMTMONTHLYFINY2PROJECTED>'
            + '<OR.PAYMENTAMTMONTHLYFINY3PROJECTED>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + ((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100))) end + '</OR.PAYMENTAMTMONTHLYFINY3PROJECTED>'
            + '<OR.PAYMENTAMTMONTHLYFINY4PROJECTED>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + (((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) * (CT.Y4EscalatePCT / 100))) end + '</OR.PAYMENTAMTMONTHLYFINY4PROJECTED>'
            + '<OR.PAYMENTAMTMONTHLYFINY5PROJECTED>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + ((((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) * (CT.Y4EscalatePCT / 100)) * (CT.Y5EscalatePCT / 100))) end + '</OR.PAYMENTAMTMONTHLYFINY5PROJECTED>'
            + '<OR.PAYMENTAMTMONTHLYFINY6PROJECTED>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((OD.AmtFinanced * OD.LeaseFactor) + (((((OD.MaintBasePayment * (CT.Y2EscalatePCT / 100)) * (CT.Y3EscalatePCT / 100)) * (CT.Y4EscalatePCT / 100)) * (CT.Y5EscalatePCT / 100)) * (CT.Y6EscalatePCT / 100))) end + '</OR.PAYMENTAMTMONTHLYFINY6PROJECTED>'
            + '<OR.PAYMENTAMTMONTHLYFINWITHSERVICE>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else case when (isnull(OD.AmtFinanced ,0) * isnull(OD.LeaseFactor ,0)) + OD.MaintBasePayment = 0 then '' else dbo.fn_FormatCurrency((isnull(OD.AmtFinanced ,0) * isnull(OD.LeaseFactor ,0)) + OD.MaintBasePayment) end end + '</OR.PAYMENTAMTMONTHLYFINWITHSERVICE>'
            + '<OR.PAYMENTNBRFIN>' + case when isnull(OD.LeaseOverride,0) = -1 then cast(isnull(OD.OverrideLeaseTerm,0) as nvarchar) else case when isnull(OD.PaymentNbrFin ,0) = 0 then '' else cast(OD.PaymentNbrFin as nvarchar) end end + '</OR.PAYMENTNBRFIN>'
            + '<OR.PAYMENTNBRFINMINUSONE>' + case when isnull(OD.LeaseOverride,0) = -1 then cast(isnull(OD.OverrideLeaseTerm - 1,0) as nvarchar) else case when isnull(OD.PaymentNbrFin ,0) = 0 then '' else cast(OD.PaymentNbrFin - 1 as nvarchar) end end + '</OR.PAYMENTNBRFINMINUSONE>'
            + '<OR.PAYMENTWITHSERVICE>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else case when BT.IncludeInLease = -1 then case when OD.PaymentAmtMonthlyFin + OD.MaintBasePayment = 0 then '' else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin + OD.MaintBasePayment) end else case when OD.PaymentAmtMonthlyFin = 0 then '' else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end end end + '</OR.PAYMENTWITHSERVICE>'
            + '<OR.PAYMENTFUNDEDWITHSERVICE>' + case when ST.IsLeased = 0 and OD.SaleTypeID > 0 then 'n/a' else case when BT.FundedInLeaseInd = -1 then case when OD.PaymentAmtMonthlyFin + OD.MaintBasePayment = 0 then '' else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin + OD.MaintBasePayment) end else case when OD.PaymentAmtMonthlyFin = 0 then '' else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end end end + '</OR.PAYMENTFUNDEDWITHSERVICE>'
            + '<OR.PBCHARGEBACK>' + dbo.fn_FormatCurrency(OD.PBChargeBackAmt) + '</OR.PBCHARGEBACK>'
            + '<OR.PRICECONFORM>' + case when isnull(OD.PricingMethod,0) <> 0 then 'Pricing is Non Conforming - ' else '' end + '</OR.PRICECONFORM>'
            + '<OR.PRICELEVEL>' + dbo.fn_FormatXMLChars(isnull(PL.Name ,'')) + '</OR.PRICELEVEL>'
            + '<OR.PRICELEVELDESCRIPTION>' + dbo.fn_FormatXMLChars(isnull(PL.Description ,'')) + '</OR.PRICELEVELDESCRIPTION>'
            + '<OR.PRICELEVELLEGALTEXT>' + dbo.fn_FormatXMLChars(isnull(PL.LegalText ,'')) + '</OR.PRICELEVELLEGALTEXT>'
            + '<OR.PRICEMETHOD>' + case isnull(OD.PricingMethod,0) when 0 then 'Point Book' when 1 then 'Promo/Special' when 2 then 'Bid Desk' when 3 then 'Branch Manager' when 4 then 'Double Contest' else '' end + '</OR.PRICEMETHOD>'
            + '<OR.PROPOSALNAME>' + dbo.fn_FormatXMLChars(isnull(OD.ProposalName,'')) + '</OR.PROPOSALNAME>'
            + '<OR.PS24MOPYMT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(OD.PS24MoPymt) end + '</OR.PS24MOPYMT>'
            + '<OR.PS36MOPYMT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(OD.PS36MoPymt) end + '</OR.PS36MOPYMT>'
            + '<OR.PS48MOPYMT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(OD.PS48MoPymt) end + '</OR.PS48MOPYMT>'
            + '<OR.PS60MOPYMT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency(OD.PS60MoPymt) end + '</OR.PS60MOPYMT>'
            + '<OR.PYMTFREQANX>' + case when LP.PaymentFrequency = 1 then 'X' else '' end + '</OR.PYMTFREQANX>'
            + '<OR.PYMTFREQLONG>' + case when LP.PaymentFrequency = 12 then 'Monthly' else
                                    case when LP.PaymentFrequency = 4 then 'Quarterly' else
                                    case when LP.PaymentFrequency = 2 then 'Semi-Annual' else
                                    case when LP.PaymentFrequency = 1 then 'Annual' else '??Unknown' end end end end + '</OR.PYMTFREQLONG>'
            + '<OR.PYMTFREQMOX>' + case when LP.PaymentFrequency = 12 then 'X' else '' end + '</OR.PYMTFREQMOX>'
            + '<OR.PYMTFREQQTRX>' + case when LP.PaymentFrequency = 4 then 'X' else '' end + '</OR.PYMTFREQQTRX>'
            + '<OR.PYMTFREQSAX>' + case when LP.PaymentFrequency = 2 then 'X' else '' end + '</OR.PYMTFREQSAX>'
            + '<OR.PYMTFREQSHORT>' + case when LP.PaymentFrequency = 12 then 'MO' else
                                    case when LP.PaymentFrequency = 4 then 'QT' else
                                    case when LP.PaymentFrequency = 2 then 'SA' else
                                    case when LP.PaymentFrequency = 1 then 'AN' else '??' end end end end + '</OR.PYMTFREQSHORT>'
            + '<OR.PYMTPLUSSERVPLUSPM>' + dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin + (select sum(isnull(BundleQuantity,1) * isnull(MonthlyMeter,0)) from SNOrderLine with (nolock) where OrderID = OD.OrderID)) + '</OR.PYMTPLUSSERVPLUSPM>'
            + '<OR.PYMTSTBL>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.NbrDeferredPymts,0) = 0 then case when OD.PaymentAmtMonthlyFin = 0 then '' else case when isnull(BT.IncludeInLease,0) = -1 then dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end end else '$0.00' + char(13) + case when isnull(BT.IncludeInLease,0) = -1 then dbo.fn_FormatCurrency(isnull(OD.AmtFinanced,0) * isnull(OD.LeaseFactor,0)) else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end end end + '</OR.PYMTSTBL>'
            + '<OR.PYMTSTBLDEF>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.NbrDeferredPymts,0) > 0 then cast(isnull(OD.NbrDeferredPymts,0) as nvarchar) + ' @ $0.00' + char(13) + cast(OD.NbrLeasePymts - isnull(OD.NbrDeferredPymts,0) as nvarchar) + ' @ ' + dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) else cast(OD.NbrLeasePymts as nvarchar) + ' @ ' + dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end end + '</OR.PYMTSTBLDEF>'
            + '<OR.PYMTSTBLTOTAL>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else case when isnull(OD.NbrDeferredPymts,0) = 0 then case when OD.PaymentAmtMonthlyFin = 0 then '' else dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end else '$0.00' + char(13) + dbo.fn_FormatCurrency(OD.PaymentAmtMonthlyFin) end end + '</OR.PYMTSTBLTOTAL>'
            + '<OR.REPCOSTANDEXPENSES>' + dbo.fn_FormatCurrency((select sum(BuyPrice * Quantity) from SNOrderLine with (nolock) where OrderID = OD.OrderID) + (select sum(case when isnull(oat.IsSoftCost,0) = -1 then case when oat.CreditDebitInd = 'C' then -1 * oa.AdjAmount else oa.AdjAmount end else 0 end) from SNOrderAdjustment oa with (nolock) join SNOrderAdjType oat with (nolock) on oat.OrderAdjTypeID = oa.OrderAdjTypeID where oa.OrderID = OD.OrderID)) + '</OR.REPCOSTANDEXPENSES>'
            + '<OR.SALESMANAGERNAME>' +  dbo.fn_FormatXMLChars(isnull(SMP.FirstName,'') + ' ' + case when isnull(SMP.MiddleName,'') <> '' then  SMP.MiddleName + ' ' else '' end + isnull(SMP.LastName,'')) + '</OR.SALESMANAGERNAME>'
            + '<OR.SALESREP>' + dbo.fn_FormatXMLChars(isnull(SRP.FirstName,'') + ' ' + case when isnull(SRP.MiddleName,'') <> '' then  SRP.MiddleName + ' ' else '' end + isnull(SRP.LastName,'')) + '</OR.SALESREP>'
            + '<OR.SALESREPCELLPHONE>' + dbo.fn_FormatPhoneNumber((select p.PhoneNbr from SNPhone p with (nolock) join SNEntityPhone e with (nolock) on e.PhoneID = p.PhoneID where e.EntityID = SRP.EntityID and e.PhoneTypeID = (select PhoneTypeID from SNPhoneType with (nolock) where SystemLabel = 'Person.CellPhone'))) + '</OR.SALESREPCELLPHONE>'
            + '<OR.SALESREPEMAIL>' + dbo.fn_FormatXMLChars(isnull(SRP.EmailAddress ,'')) + '</OR.SALESREPEMAIL>'
            + '<OR.SALESREPPHONE>' + dbo.fn_FormatPhoneNumber(PH.PhoneNbr) + '</OR.SALESREPPHONE>'
            + '<OR.SALESREPPHONEEXT>' + dbo.fn_FormatXMLChars(isnull(PH.PhoneExt,'')) + '</OR.SALESREPPHONEEXT>'
            + '<OR.SALESREPTITLE>' + dbo.fn_FormatXMLChars(isnull(SR.Title,'')) + '</OR.SALESREPTITLE>'
            + '<OR.SALESREPXREF>' + dbo.fn_FormatXMLChars(isnull(EN.ImportXref ,'')) + '</OR.SALESREPXREF>'
            + '<OR.SERVICECOMMENTS>' + dbo.fn_FormatXMLChars(isnull(OD.SvcComments,'')) + '</OR.SERVICECOMMENTS>'
            + '<OR.SRCCOMMAMT>' + dbo.fn_FormatCurrency(OD.SalesRepCommissionAmt) + '</OR.SRCCOMMAMT>'
            + '<OR.SRCCOMMBONUS>' + dbo.fn_FormatCurrency(OD.SRCommMaintBonus) + '</OR.SRCCOMMBONUS>'
            + '<OR.SRCCOMMPCT>' + dbo.fn_formatnumber(OD.SRCommPCTPaid * 100,2) + '%' + '</OR.SRCCOMMPCT>'
            + '<OR.SRCCOMMSVCBONUS>' + dbo.fn_FormatCurrency(OD.SRCommMaintService) + '</OR.SRCCOMMSVCBONUS>'
            + '<OR.SRCINVOICENBR>' + dbo.fn_FormatXMLChars(isnull(OD.InvoiceNbr,'')) + '</OR.SRCINVOICENBR>'
            + '<OR.SRCLEVELNAME>' + dbo.fn_FormatXMLChars(isnull(CLVL.Name,'')) + '</OR.SRCLEVELNAME>'
            + '<OR.SRCNOTE>' + dbo.fn_FormatXMLChars(cast(isnull(OD.SRCommNote,'') as nvarchar(max))) + '</OR.SRCNOTE>'
            + '<OR.SRCOTHERSALESREPCOMMAMT>' + dbo.fn_FormatCurrency(OD.SplitSRCommissionAmt) + '</OR.SRCOTHERSALESREPCOMMAMT>'
            + '<OR.SRCOTHERSALESREPPCT>' + dbo.fn_formatnumber(OD.OtherSalesRepPCT,2) + '%' + '</OR.SRCOTHERSALESREPPCT>'
            + '<OR.SRCPRIAMT>' + dbo.fn_FormatCurrency((select sum(EarnedCommAmt) from SNSRCommEarned with (nolock) where OrderID = OD.OrderID and UserID = OD.SalesRepUserID)) + '</OR.SRCPRIAMT>'
            + '<OR.SRCPRIAMTEQCOMM>' + dbo.fn_FormatCurrency(isnull(OD.AdjGPAmt,0) * isnull(OD.SRCommPCTPaid,0)) + '</OR.SRCPRIAMTEQCOMM>'
            + '<OR.SRCPRIMSALESREPCOMMAMT>' + dbo.fn_FormatCurrency(OD.PrimarySRCommissionAmt) + '</OR.SRCPRIMSALESREPCOMMAMT>'
            + '<OR.SRCSALESORDER>' + dbo.fn_FormatXMLChars(isnull(OD.SalesOrderNbr,'')) + '</OR.SRCSALESORDER>'
            + '<OR.SRCSEGMENTBONUSAMT>' + dbo.fn_FormatCurrency(OD.SegmentBonusValue) + '</OR.SRCSEGMENTBONUSAMT>'
            + '<OR.SRCSERVICEAMT>' + dbo.fn_FormatCurrency(OD.SRCommServiceValue) + '</OR.SRCSERVICEAMT>'
            + '<OR.SRCSERVICERATE>' + dbo.fn_formatnumber(OD.SRCommServiceRate * 100,2) + '%' + '</OR.SRCSERVICERATE>'
            + '<OR.SRCSPLITREPNAME>' + dbo.fn_FormatXMLChars(isnull((select isnull(oPR.FirstName,'') + ' ' + isnull(oPR.LastName,'') from SNUser oUS with (nolock) join SNPerson oPR with (nolock) on oPR.PersonID = oUS.PersonID where oUS.UserID = OD.OtherSalesRepUserID),'')) + '</OR.SRCSPLITREPNAME>'
            + '<OR.SRCTOTALCOMMAMT>' + dbo.fn_FormatCurrency(OD.SRCommTotalAmt) + '</OR.SRCTOTALCOMMAMT>'
            + '<OR.STATUSNOTE>' + dbo.fn_FormatXMLChars(isnull((select top 1 Note from SNOrderHistory h with (nolock) where h.OrderID = OD.OrderID and h.ToStatusID = OD.OrderStatusID order by DTChanged desc),'')) + '</OR.STATUSNOTE>'
            + '<OR.SUBTOTALSELLPRICE>' + dbo.fn_FormatCurrency(OD.SubTotalAmount) + '</OR.SUBTOTALSELLPRICE>'
            + '<OR.SUBTOTAL24MOPYMT>' + dbo.fn_FormatCurrency((select sum(val) from (select cast(convert(nvarchar(50),convert(money,coalesce(l.LineTotal * o.Lease24moFactor,0)),1) as money) val from SNOrderLine l with (nolock) join SNOrder o with (nolock) on o.OrderID = l.OrderID where isnull(l.ServiceInd,0) = 0 and l.OrderID = OD.OrderID) t)) + '</OR.SUBTOTAL24MOPYMT>'
            + '<OR.SUBTOTAL36MOPYMT>' + dbo.fn_FormatCurrency((select sum(val) from (select cast(convert(nvarchar(50),convert(money,coalesce(l.LineTotal * o.Lease36moFactor,0)),1) as money) val from SNOrderLine l with (nolock) join SNOrder o with (nolock) on o.OrderID = l.OrderID where isnull(l.ServiceInd,0) = 0 and l.OrderID = OD.OrderID) t)) + '</OR.SUBTOTAL36MOPYMT>'
            + '<OR.SUBTOTAL48MOPYMT>' + dbo.fn_FormatCurrency((select sum(val) from (select cast(convert(nvarchar(50),convert(money,coalesce(l.LineTotal * o.Lease48moFactor,0)),1) as money) val from SNOrderLine l with (nolock) join SNOrder o with (nolock) on o.OrderID = l.OrderID where isnull(l.ServiceInd,0) = 0 and l.OrderID = OD.OrderID) t)) + '</OR.SUBTOTAL48MOPYMT>'
            + '<OR.SUBTOTAL60MOPYMT>' + dbo.fn_FormatCurrency((select sum(val) from (select cast(convert(nvarchar(50),convert(money,coalesce(l.LineTotal * o.Lease60moFactor,0)),1) as money) val from SNOrderLine l with (nolock) join SNOrder o with (nolock) on o.OrderID = l.OrderID where isnull(l.ServiceInd,0) = 0 and l.OrderID = OD.OrderID) t)) + '</OR.SUBTOTAL60MOPYMT>'
            + '<OR.SUBTOTALLEASEPYMT>' + dbo.fn_FormatCurrency((select sum(val) from (select cast(convert(nvarchar(50),convert(money,coalesce(l.LineTotal * o.LeaseFactor,0)),1) as money) val from SNOrderLine l with (nolock) join SNOrder o with (nolock) on o.OrderID = l.OrderID where isnull(l.ServiceInd,0) = 0 and l.OrderID = OD.OrderID) t)) + '</OR.SUBTOTALLEASEPYMT>'
            + '<OR.SUBTOTALUNITLEASEPYMT>' + dbo.fn_FormatCurrency((select sum(val) from (select cast(convert(nvarchar(50),convert(money,coalesce(l.SellPrice * o.LeaseFactor,0)),1) as money) val from SNOrderLine l with (nolock) join SNOrder o with (nolock) on o.OrderID = l.OrderID where isnull(l.ServiceInd,0) = 0 and l.OrderID = OD.OrderID) t)) + '</OR.SUBTOTALUNITLEASEPYMT>'
            + '<OR.SVANNUALGP>' + case when isnull(OD.SVANNUALGP,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVANNUALGP) end + '</OR.SVANNUALGP>'
            + '<OR.SVANNUALPRICE>' + case when isnull(OD.SVANNUALPRICE,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVANNUALPRICE) end + '</OR.SVANNUALPRICE>'
            + '<OR.SVBASEBILLFREQANX>' + case when isnull(SBT.PaymentsPerYear,0) = 1 then 'X' else '' end + '</OR.SVBASEBILLFREQANX>'
            + '<OR.SVBASEBILLFREQMOX>' + case when isnull(SBT.PaymentsPerYear,0) = 12 then 'X' else '' end + '</OR.SVBASEBILLFREQMOX>'
            + '<OR.SVBASEBILLFREQQTRX>' + case when isnull(SBT.PaymentsPerYear,0) = 4 then 'X' else '' end + '</OR.SVBASEBILLFREQQTRX>'
            + '<OR.SVBASEBILLFREQSAX>' + case when isnull(SBT.PaymentsPerYear,0) = 2 then 'X' else '' end + '</OR.SVBASEBILLFREQSAX>'
            + '<OR.SVBILLCYCLENAME>' + dbo.fn_FormatXMLChars(isnull(SBT.Name,'')) + '</OR.SVBILLCYCLENAME>'
            + '<OR.SVBILLCYCLENAMEOTHER>' + dbo.fn_FormatXMLChars(isnull(SBT.OtherName,'')) + '</OR.SVBILLCYCLENAMEOTHER>'
            + '<OR.SVBILLCYCLEPPY>' + case when isnull(SBT.PaymentsPerYear,0) = 0 then '' else dbo.fn_FORMATNumber(SBT.PaymentsPerYear,0) end + '</OR.SVBILLCYCLEPPY>'
            + '<OR.SVCOSTPERUSER>' + case when isnull(OD.SVCOSTPERUSER,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVCOSTPERUSER) end + '</OR.SVCOSTPERUSER>'
            + '<OR.SVENDDT>' + case when isnull(OD.SVSTARTDT,'1/1/1900') = '1/1/1900' or isnull(OD.SVTERM,0) = 0 then '' else convert(nvarchar, dateadd(mm,OD.SVTERM,OD.SVSTARTDT), 101) end + '</OR.SVENDDT>'
            + '<OR.SVMOCOST>' + case when isnull(OD.SVMOCOST,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVMOCOST) end + '</OR.SVMOCOST>'
            + '<OR.SVMOGP>' + case when isnull(OD.SVMOGP,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVMOGP) end + '</OR.SVMOGP>'
            + '<OR.SVMOREPCOST>' + case when isnull(OD.SVMOREPCOST,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVMOREPCOST) end + '</OR.SVMOREPCOST>'
            + '<OR.SVMOSELLPRICE>' + case when isnull(OD.SVMOSELLPRICE,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVMOSELLPRICE) end + '</OR.SVMOSELLPRICE>'
            + '<OR.SVMOSELLPRICENOSIGN>' + case when isnull(OD.SVMOSELLPRICE,0) = 0 then '' else replace(dbo.fn_FormatCurrency(OD.SVMOSELLPRICE),'$','') end + '</OR.SVMOSELLPRICENOSIGN>'
            + '<OR.SVNBRUSERS>' + case when isnull(OD.SVNBRUSERS,0) = 0 then '' else dbo.fn_FormatNumber(OD.SVNBRUSERS,0) end + '</OR.SVNBRUSERS>'
            + '<OR.SVPERIODSELLPRICE>' + case when isnull(OD.SVMOSELLPRICE,0) = 0 or isnull(SBT.PaymentsPerYear,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVMOSELLPRICE * (12/isnull(SBT.PaymentsPerYear,12))) end + '</OR.SVPERIODSELLPRICE>'
            + '<OR.SVSTARTDT>' + case when isnull(OD.SVSTARTDT,'1/1/1900') = '1/1/1900' then '' else convert(nvarchar, OD.SVSTARTDT, 101) end + '</OR.SVSTARTDT>'
            + '<OR.SVTERM>' + case when isnull(OD.SVTERM,0) = 0 then '' else dbo.fn_FormatNumber(OD.SVTERM,0) end + '</OR.SVTERM>'
            + '<OR.SVTOTALGP>' + case when isnull(OD.SVTOTALGP,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVTOTALGP) end + '</OR.SVTOTALGP>'
            + '<OR.SVTOTALVALUE>' + case when isnull(OD.SVTOTALVALUE,0) = 0 then '' else dbo.fn_FormatCurrency(OD.SVTOTALVALUE) end + '</OR.SVTOTALVALUE>'
            + '<OR.TOTALADVLEASEPYMT>' + case when isnull(ST.IsLeased,0) = 0 and OD.SaleTypeID > 0 then 'n/a' else dbo.fn_FormatCurrency((isnull(OD.AmtFinanced ,0) * isnull(OD.LeaseFactor ,0)) * isnull(LP.NbrDown,0))  end + '</OR.TOTALADVLEASEPYMT>'
            + '<OR.TOTALDEALERCOST>' + dbo.fn_FormatCurrency((select sum(OL.DealerCostAmt) from SNOrderLine OL with (nolock) where OL.OrderID = OD.OrderID)) + '</OR.TOTALDEALERCOST>'
            + '<OR.TOTALMSRP>' + dbo.fn_FormatCurrency(ISNULL(OD.TotalMSRP,0)) + '</OR.TOTALMSRP>'
            + '<OR.TOTALMSRPPCTFIN>' + dbo.fn_formatnumber(ISNULL(case when OD.TotalMSRP > 0 and OD.AmtFinanced > 0 then OD.AmtFinanced/OD.TotalMSRP else OD.TotalMSRP end,0) * 100,0) + '%' + '</OR.TOTALMSRPPCTFIN>'
            + '<OR.TOTALNUMADVLEASEPYMT>' + cast(isnull(LP.NbrDown,0) as nvarchar) + '</OR.TOTALNUMADVLEASEPYMT>'
            + '<OR.TOTALNUMDEFLEASEPYMT>' + cast(isnull(LP.NbrDeferred,0) as nvarchar) + '</OR.TOTALNUMDEFLEASEPYMT>'
            + '<OR.TOTALSELLNOTAX>' + dbo.fn_FormatCurrency(TotalOrderAmount - isnull((select AdjAmount from SNOrderAdjustment oa with (nolock) join SNOrderAdjType oat with (nolock) on oat.OrderAdjTypeID = oa.OrderAdjTypeID where oa.OrderID = OD.OrderID and oat.Taxind = -1),0)) + '</OR.TOTALSELLNOTAX>'
            + '<OR.TOTALSELLPRICE>' + dbo.fn_FormatCurrency(TotalOrderAmount) + '</OR.TOTALSELLPRICE>'
            + '<OR.TOTALSERVICECONTRACT>' + dbo.fn_FormatCurrency(OD.MaintTotalValue) + '</OR.TOTALSERVICECONTRACT>'
            + '<OR.TRAVELCATEGORY>' + dbo.fn_FormatXMLChars(isnull(TC.Name,'')) + '</OR.TRAVELCATEGORY>'
            + '<OR.TRAVELCATEGORYDOCDESC>' + dbo.fn_FormatXMLChars(isnull(TC.DocDescription,'')) + '</OR.TRAVELCATEGORYDOCDESC>'
            + '<OR.TRAVELCATEGORYMINCHARGE>' + dbo.fn_FormatCurrency(TC.MinimumCharge) + '</OR.TRAVELCATEGORYMINCHARGE>'
            + '<OR.TRAVELCATEGORYMILLAGECHARGE>' + dbo.fn_FormatCurrency(TC.MillageCharge) + '</OR.TRAVELCATEGORYMILLAGECHARGE>'
            + '<OR.TRAVELCATEGORYPERPERSONDAILYCOST>' + dbo.fn_FormatCurrency(TC.DailyCostPerPersonAmt) + '</OR.TRAVELCATEGORYPERPERSONDAILYCOST>'
            + '<OR.TRAVELFEENBRDAYS>' + dbo.fn_formatnumber(OD.TravelNbrNights,0) + '</OR.TRAVELFEENBRDAYS>'
            + '<OR.TRAVELFEENBRMILES>' + dbo.fn_formatnumber(OD.TravelNbrMiles,0) + '</OR.TRAVELFEENBRMILES>'
            + '<OR.TRAVELFEENBRPEOPLE>' + dbo.fn_formatnumber(OD.TravelNbrPeople,0) + '</OR.TRAVELFEENBRPEOPLE>'
            + '<OR.TYPEOFOBJECT>' + case when OS.SystemLabel = 'PROP' then 'Proposal' else 'Order' end + '</OR.TYPEOFOBJECT>'
            + '<OR.TYPEOFSALE>' + dbo.fn_FormatXMLChars(isnull(ST.Name,'')) + '</OR.TYPEOFSALE>'
            + '<OR.TYPEORDERID>' + case when OS.SystemLabel = 'PROP' then 'P-' else '' end  + cast(OD.OrderID as nvarchar) + '</OR.TYPEORDERID>'
            + '<OR.UPGRADEFCONAME>' + dbo.fn_FormatXMLChars(replace(isnull(UCO.Name,''),'_',' ')) + '</OR.UPGRADEFCONAME>'
            + '<OR.UPGRADEFCOADDRESSONELINE>' + dbo.fn_FormatXMLChars(case when len(isnull(UFC.RPTCity,'')) > 0 then isnull(UFC.RPTAddress1,'') + case when LEN(isnull(UFC.RPTAddress2,'')) > 0 then ' ' + isnull(UFC.RPTAddress2,'') else '' end  + ', ' +  isnull(UFC.RPTCity,'') + ', ' + isnull(UFC.RPTState,'') + ' ' + isnull(UFC.RPTZip,'') else '' end) + '</OR.UPGRADEFCOADDRESSONELINE>'
            + '<OR.UPGRADEFCOADDRESS1>' + dbo.fn_FormatXMLChars(isnull(UFC.RPTAddress1,'')) + '</OR.UPGRADEFCOADDRESS1>'
            + '<OR.UPGRADEFCOADDRESS2>' + dbo.fn_FormatXMLChars(isnull(UFC.RPTAddress2,'')) + '</OR.UPGRADEFCOADDRESS2>'
            + '<OR.UPGRADEFCOCITY>' + dbo.fn_FormatXMLChars(isnull(UFC.RPTCity,'')) + '</OR.UPGRADEFCOCITY>'
            + '<OR.UPGRADEFCOSTATE>' + dbo.fn_FormatXMLChars(isnull(UFC.RPTState,'')) + '</OR.UPGRADEFCOSTATE>'
            + '<OR.UPGRADEFCOZIP>' + dbo.fn_FormatXMLChars(isnull(UFC.RPTZip,'')) + '</OR.UPGRADEFCOZIP>'
            + '<OR.UPGRADELSNBR>' + dbo.fn_FormatXMLChars(case when isnull(OD.LeaseUpgradeInd,0) = -1 then  isnull(OD.UpgradeFCOLeaseNbr,'') else '' end) + '</OR.UPGRADELSNBR>'
            + '<OR.UPGRADENOX>' + case when isnull(OD.LeaseUpgradeInd,0) = 0 then 'X' else '' end + '</OR.UPGRADENOX>'
            + '<OR.UPGRADETYPE>' + isnull((select Name from SNUpgradeType with (nolock) where UpgradeTypeID = OD.UpgradeTypeID),'') + '</OR.UPGRADETYPE>'
            + '<OR.UPGRADEYESNO>' + case when isnull(OD.LeaseUpgradeInd,0) = -1 then 'Yes' else 'No' end + '</OR.UPGRADEYESNO>'
            + '<OR.UPGRADEYESX>' + case when isnull(OD.LeaseUpgradeInd,0) = -1 then 'X' else '' end + '</OR.UPGRADEYESX>'

            + '<OR.TOTALMOAMT>' + dbo.fn_FormatCurrency(OD.SPMTotalMoAdjAmt) + '</OR.TOTALMOAMT>'
            + '<OR.TOTALMOAMTACTUAL>' + dbo.fn_FormatCurrency(OD.SPMTotalMoAdjAmtActual) + '</OR.TOTALMOAMTACTUAL>'
            + '<OR.WTMOREVAMT>' + case when isnull(OD.WTMORevAmt,0) = 0 then '' else dbo.fn_FormatCurrency(OD.WTMORevAmt) end + '</OR.WTMOREVAMT>'
            + '<OR.WTMOGPAMT>' + case when isnull(OD.WTMOGPAmt,0) = 0 then '' else dbo.fn_FormatCurrency(OD.WTMOGPAmt) end + '</OR.WTMOGPAMT>'
            + '<OR.WTTERM>' + case when isnull(OD.WTTerm,0) = 0 then '' else dbo.fn_FormatNumber(OD.WTTerm,0) end + '</OR.WTTERM>'
            + '<OR.CREDITAPPNOTE>' + dbo.fn_FormatXMLChars(isnull(OD.CreditAppNote ,'')) + '</OR.CREDITAPPNOTE>'
            FROM SNOrder AS OD with (nolock) 
            LEFT JOIN SNContractType as CT with (nolock) on CT.ContractTypeID = OD.MaintContractTypeID 
            LEFT JOIN SNBillingCycleType as BT with (nolock) on BT.BillingCycleTypeID = OD.MaintBillingCycle 
            LEFT JOIN SNBillingCycleType as OBT with (nolock) on OBT.BillingCycleTypeID = OD.MaintOverBillingCycle
            LEFT JOIN SNBillingCycleType as SBT with (nolock) on SBT.BillingCycleTypeID = OD.SVBillingCycleID
            LEFT JOIN SNLeaseProduct as LP with (nolock) on LP.LeaseProductID = OD.LeaseProductID 
            LEFT JOIN SNSaleType as ST with (nolock) on ST.SaleTypeID = OD.SaleTypeID 
            LEFT JOIN SNOrderStatus as OS with (nolock) on OS.OrderStatusID = OD.OrderStatusID 
            LEFT JOIN SNPriceLevel as PL with (nolock) on PL.PriceLevelID = OD.PriceLevelID 
            LEFT JOIN SNLeasePriceLevel as LPL with (nolock) on LPL.LeasePriceLevelID = OD.LeasePriceLevelID 
            LEFT JOIN SNCustomer as BCU with (nolock) on BCU.CustomerID = OD.BillToAccountSelect 
            LEFT JOIN SNUser as SR with (nolock) on SR.UserID = OD.SalesRepUserID 
            LEFT JOIN SNPerson as SRP with (nolock) on SRP.PersonID = SR.PersonID 
            LEFT JOIN SNEntityPhone as EP with (nolock) on EP.EntityID = SRP.EntityID and EP.PhoneTypeID = (Select PhoneTypeID FROM SNPhoneType with (nolock) where Name = 'Office') 
            LEFT JOIN SNPhone as PH with (nolock) on PH.PhoneID = EP.PhoneID 
            LEFT JOIN SNEntity as EN with (nolock) on EN.EntityID = SRP.EntityID 
            LEFT JOIN SNBranch as BR with (nolock) on BR.BranchID = SR.BranchID 
            LEFT JOIN SNBusiness as BU with (nolock) on BU.BusinessID = BR.BusinessID 
            LEFT JOIN SNProspect as PR with (nolock) on PR.ProspectID = OD.ProspectID 
            LEFT JOIN SNFinanceCompany as FC with (nolock) on FC.FCOID = OD.FCOID
            LEFT JOIN SNCompany as CO with (nolock) on CO.CompanyID = FC.CompanyID
            LEFT JOIN SNFinanceCompany as UFC with (nolock) on UFC.FCOID = OD.UpgradeFCOID
            LEFT JOIN SNCompany as UCO with (nolock) on UCO.CompanyID = UFC.CompanyID
            LEFT JOIN SNSRCommCSMPLevel as CSMP with (nolock) on CSMP.SRCommCSMPLevelID = OD.SRCommCSMPLevelID
            LEFT JOIN SNSRCommLevel as CLVL with (nolock) on CLVL.SRCommLevelID = OD.SRCommLevelID
            LEFT JOIN SNUser as SMU with (nolock) on SMU.UserID = BR.SalesManagerUserID
            LEFT JOIN SNPerson as SMP with (nolock) on SMP.PersonID = SMU.PersonID
            LEFT JOIN SNDMPaymentTerms as IPB with (nolock) on IPB.DMPaymentTermsID = OD.ITPPaymentTermsID
            LEFT JOIN SNDMPaymentTerms as BTB with (nolock) on BTB.DMPaymentTermsID = OD.ITP_BOT_PaymentTermsID
            LEFT JOIN SNDMPaymentTerms as DMB with (nolock) on DMB.DMPaymentTermsID = OD.DMPaymentTermsID
            LEFT JOIN SNCreditApplication as CA with (nolock) on CA.OrderID = OD.OrderID AND CA.SelectedSource = -1
            LEFT JOIN SNFinanceCompany as CFC with (nolock) on CFC.FCOID = CA.FCOID
            LEFT JOIN SNTravelCategory as TC with (nolock) on TC.TravelCategoryID = OD.TravelCategoryID